---
import Layout from '~/layouts/PageLayout.astro';
import { getCollection } from 'astro:content';
import { cleanSlug, getPermalink } from '~/utils/permalinks';
import { getNotionEntryTitle } from '~/utils/notion';

interface RRItem {
  id: string;
  data: unknown;
}
const getCollectionAny = getCollection as unknown as (name: string) => Promise<RRItem[]>;
const items = await getCollectionAny('rrresources');

const title = 'RR Resources';
const description = 'Curated resources from the Notion database';

// use helper to extract title consistently
---

<Layout metadata={{ title, description }}>
  <section class="container mx-auto px-4 py-8">
    <h1 class="mb-6 text-3xl font-bold">{title}</h1>
    {
      items.length === 0 ? (
        <p>No resources found.</p>
      ) : (
        <ul class="grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3">
          {items.map(entry => {
            const data = (entry.data ?? {}) as { Type?: string[]; Category?: string[] };
            const titleText = getNotionEntryTitle(entry);
            const slug = cleanSlug(titleText);
            const href = getPermalink(`/rr-resources/${slug}`, 'post');
            const type = Array.isArray(data.Type) ? data.Type[0] : undefined;
            const category = Array.isArray(data.Category) ? data.Category[0] : undefined;

            return (
              <li class="rounded-lg border bg-white p-4 dark:bg-gray-900">
                <a href={href} class="text-lg font-semibold hover:underline">
                  {titleText}
                </a>
                {(type || category) && (
                  <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                    {type ? `Type: ${type}` : ''}
                    {type && category ? ' Â· ' : ''}
                    {category ? `Category: ${category}` : ''}
                  </p>
                )}
              </li>
            );
          })}
        </ul>
      )
    }
  </section>
</Layout>
