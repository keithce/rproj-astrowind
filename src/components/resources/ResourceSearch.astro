---
export interface Props {
  class?: string;
  placeholder?: string;
}

const { class: className = '', placeholder = 'Search RR Resources...' } = Astro.props;
---

<div class={`rr-search ${className}`}>
  <form id="search-form" class="relative">
    <input
      type="text"
      id="search-input"
      name="q"
      placeholder={placeholder}
      class="bg-muted/50 border-border text-foreground placeholder-muted-foreground focus:ring-primary w-full rounded-md border px-4 py-3 focus:ring-2 focus:outline-none"
    />
    <button
      type="submit"
      class="text-muted-foreground hover:text-primary absolute top-1/2 right-3 -translate-y-1/2 transform transition-colors"
      aria-label="Search"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
    </button>
  </form>
</div>

<script>
  // Client-side search functionality
  document.addEventListener('DOMContentLoaded', () => {
    const searchForm = document.getElementById('search-form');
    const searchInputElement = document.querySelector('input#search-input');

    // Runtime type guard to ensure we have a valid input element
    if (!searchInputElement) {
      return;
    }

    // Check URL for search query
    const urlParams = new URLSearchParams(window.location.search);
    const queryParam = urlParams.get('q');
    if (queryParam) {
      // Use setAttribute to set the value
      searchInputElement.setAttribute('value', queryParam);
    }

    searchForm?.addEventListener('submit', e => {
      e.preventDefault();
      // Get the input value directly from the input element
      const queryValue = searchInputElement.getAttribute('value') || '';
      if (queryValue.trim()) {
        window.location.href = `/resources?q=${encodeURIComponent(queryValue.trim())}`;
      } else {
        window.location.href = '/resources';
      }
    });
  });
</script>
